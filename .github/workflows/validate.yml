name: Validate Skills

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Validate SKILL.md frontmatter
        run: |
          SKILL_FILE="skills/outlit-sdk/SKILL.md"
          if [ ! -f "$SKILL_FILE" ]; then
            echo "ERROR: $SKILL_FILE not found"
            exit 1
          fi

          # Check YAML frontmatter exists
          if ! head -1 "$SKILL_FILE" | grep -q "^---$"; then
            echo "ERROR: Missing opening frontmatter delimiter"
            exit 1
          fi

          # Check name field
          if ! grep -q "^name:" "$SKILL_FILE"; then
            echo "ERROR: Missing 'name' in frontmatter"
            exit 1
          fi

          # Check description field
          if ! grep -q "^description:" "$SKILL_FILE"; then
            echo "ERROR: Missing 'description' in frontmatter"
            exit 1
          fi

          echo "OK: SKILL.md frontmatter valid"

      - name: Check skill is self-contained
        run: |
          SKILL_DIR="skills/outlit-sdk"

          # Skill should be a single SKILL.md with no other files
          FILE_COUNT=$(find "$SKILL_DIR" -type f | wc -l)
          if [ "$FILE_COUNT" -ne 1 ]; then
            echo "ERROR: Expected 1 file in $SKILL_DIR, found $FILE_COUNT"
            find "$SKILL_DIR" -type f
            exit 1
          fi

          echo "OK: Skill is self-contained (SKILL.md only)"

      - name: Check root entry points
        run: |
          for f in CLAUDE.md AGENTS.md README.md LICENSE; do
            if [ ! -f "$f" ]; then
              echo "ERROR: Missing $f"
              exit 1
            fi
            echo "OK: $f"
          done
